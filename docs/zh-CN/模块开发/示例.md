## 最小示例

```python
from core.dispatcher import on_message
from models.api import Message

@on_message("hello")  # 忽略大小写的正则完全匹配
async def _(event: Message):  # 通过 kwargs 向回调传递参数
    await event.reply("world!")  # 带引用回复
```

## 获取正则捕获组

```python
import re

@on_message(re.compile(r"hello (\w+)"))  # 区分大小写的完全匹配
async def _(event: Message, match_: re.Match):
    await event.reply(f"word {match_[1]}!")
```

## 绝对匹配、发送复杂消息

```python
from core.expr import Pmsg
from models.msg import Text, Image, MsgSeq

@on_message(Pmsg == "hello")  # 绝对匹配
async def _(event: Message):
    msg = MsgSeq(
        Text(text="hello"),  # 实例化消息段时只能使用关键字参数。
        " world!",  # 普通字符串会被自动转换成 Text 实例。
        Image(file="https://http.cat/images/200.jpg")  # 可以为本地路径。
    )
    msg += ["https://http.cat/images/200.jpg"]  # MsgSeq 是 list 的子类，支持绝大多数 list 操作。

    await event.send(msg)  # 无引用直接发送
```

## 处理 [Request](../数据结构/事件对象.md#request) 事件

```python
from core.dispatcher import on_request
from models.api import Request

@on_request("group", "invite")  # 第一个是请求事件主类型，第二个是子类型
@on_request("friend")
async def _(event: Request):
    await event.approve()  # 同意请求
    await event.approve(False)  # 拒绝请求
```

## 通过类型注解约束消息事件、获取文件

```python
from anyio import Path
from models.msg import Downloadable  # Image、Sticker、File、Record、Video 均继承自 Downloadable

@on_message()
async def _(event: Message[Downloadable]):  # 通过类型注解约束匹配的消息内容
    path: Path = await event.message[0].download()  # 下载文件，默认保存至文件缓存目录。可通过 dir_ 和 name 参数指定路径和文件名。
    stream: AsyncGenerator = event.message[0].stream()  # 获取文件流
```

## 调用更多 API

```python
from core.api import API

@on_message()
async def _(event: Message):
    print(await API.get_login_info())
```
