# 消息前缀

实际应用中常见 [`Message`](../../数据结构/事件对象.md#message) 的消息内容误触发回调的情景，因此 Aha 实现了消息前缀机制。

## 行为

是否使用消息前缀**由注册回调时的[匹配表达式](../../事件匹配表达式.md)控制**，通过字段 `PM.prefix` 实现。

默认情况下**同时匹配**具有前缀和不具有前缀的消息。

当调用回调函数时，始终会从 `event` 参数的消息内容中**删除前缀**。

```python
from core.expr import Pprefix
from core.dispatcher import on_message
from models.api import Message

@on_message("test", Pprefix == True)  # 要求消息内容必须具有前缀
async def _(event: Message):
    print(event.messgae_str)  # 没有前缀

@on_message("test")  # 同时匹配是否具有前缀的消息内容
async def _(event: Message):
    print(event.messgae_str)  # 始终为不具有前缀的消息内容
```

## 规则

前缀内容由配置中的 `aha.global_msg_prefix` 设置，可以通过 `msg_prefix` 键为每个模块单独设置，允许值为**任意字符串**。

默认将 [`@event.self_id`](../../数据结构/事件对象.md#baseevent)（也就是@机器人）也视为前缀。

若配置值仅为**单个** ASCII 基本拉丁字符集与对应的全角字符中的**特殊字符**，其的全半角均被视为前缀。

若配置值为空字符串，则仅将 [`@event.self_id`](../../数据结构/事件对象.md#baseevent) 视为前缀。

若配置值为 `null`，则[事件匹配表达式](../事件匹配表达式.md)的 `PM.prefix` 字段的提取值始终为 True。

## 配置示例

```yaml
aha:
  global_msg_prefix: "~"  # 此时前缀可以为 "~"、"～"、@bot

modules.example:
  msg_prefix: ""  # 此时对于 example 模块来说，前缀仅可为@bot
```
