# 事件对象

本文介绍的是`事件对象`而不是[`事件`](../模块开发/订阅与发布事件.md)。

事件对象实例会出现在注册的回调函数的 `event` 参数中。它们主要用于承载数据，也内置了常用的便捷操作方法（如 reply/approve 等）。

大部分事件相关的对象都声明在 `models.api` 中，所有事件对象都是 `BaseEvent` 的子类，是 [Pydantic](https://github.com/pydantic/pydantic) Model。

事件对象可被哈希，跨进程一致。

**Aha 仍在毛坯期，标准尚未确立，如下所有结构均有可能在以后的版本中发生破坏性更改。** 在之后的版本中适配器可能会实现自己的私有事件子类。

---

## BaseEvent

| 属性/方法 | 类型 | 说明 |
| --- | --- | --- |
| event_type | EventType(enum) | 该事件类别的主类型。 |
| sub_type | EventSubType(enum) | 该事件类别的子类型。 |
| self_id | str | 协议服务所登陆的账号 ID。 |
| time | int | 时间戳。 |
| bot_id | int | 协议适配器实例的 ID，依据配置生成，跨进程一致。 |
| platform | str | 事件来源平台，如 `QQ` 等。 |
| adapter | str | 协议适配器类名，如 `NapCat`。 |

## Message

| 属性/方法 | 类型 | 说明 |
| --- | --- | --- |
| event_type | [MessageEventType(enum)](#messageeventtype) | 主类型。 |
| sub_type | [MessageEventSubType(enum)](#messageeventsubtype) | 子类型。 |
| message_id | str \| None | 协议框架提供的消息 ID。 |
| message | [MessageChain](./消息序列与消息段.md#消息序列) | 消息内容。 |
| get_msg_inline() | [InlineStr](../模块开发/内置轮子与最佳实践/零碎%20utils.md#inlinestr) | 获取对象内联字符串。 |
| sender | [MessageSender](#messagesender) | 发送者基础信息。 |
| user_id | str | 发送者平台 ID。 |
| group_id | str \| None | 群组平台 ID。 |
| user_aha_id() | async int | 用户 [AHA ID](../模块开发/跨平台统一%20ID.md)。 |
| group_aha_id() | async int \| None | 群 [AHA ID](../模块开发/跨平台统一%20ID.md)。事件的 `group_id` 属性为 `None` 时返回 `None`。 |
| user | [User](./平台个体.md#user) | 可用于[事件匹配表达式](../模块开发/事件匹配表达式.md)的 `PM.user` 字段。 |
| group | [Group](./平台个体.md#group) | 可用于[事件匹配表达式](../模块开发/事件匹配表达式.md)的 `PM.group` 字段。 |
| is_group_msg | bool | 是否为群消息。 |

支持类型注解泛型，会将泛型转移至 `message` 属性的泛型：
```python
from models.api import Message
from models.msg import At

async def _(event: Message[At]):
    assert isinstance(event.message[0], At)
```

<details>
<summary>便捷方法</summary>

### send()

发送消息。

| 参数 | 说明 |
| --- | --- |
| msg | 要发送的消息内容。 |
| at | 是否 @ 发送者。 |
| image | 要发送的图片。|

### reply()

同 `send()`，自动引用消息。

### delete()

撤回消息。

### ban()

在群聊中禁言该用户。

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| duration | int | 禁言时长，单位为秒。 |

### kick()

在群聊中踢出该用户。

### poke()

在群聊中 Poke 该用户。

</details>

### MessageEventType

| 枚举 | 简述 |
| :---: | :---: |
| GROUP | 群聊消息事件 |
| PRIVATE | 私聊消息事件 |

### MessageEventSubType

| 枚举 | 所属主类型 | 简述 |
| :---: | :---: | :---: |
| NORMAL | GROUP |
| ANONYMOUS | GROUP | 匿名消息 |
| NOTICE | GROUP | 系统提示 |
| TEMPORARY | PRIVATE | 非好友的临时会话 |
| FRIEND | PRIVATE | 好友会话 |

### MessageSender

| 属性 | 类型 | 简述 |
| --- | --- | --- |
| nickname | str | 昵称 |
| card | str | 群名片 |
| level | str | 群等级 |
| role | [Role(enum)](./API%20相关.md#role) | 群权限 |
| title | str | 群头衔 |

## Request

「加好友」或「加群」请求。[示例](../模块开发/示例.md#处理-request-事件)

| 属性 | 类型 | 说明 |
| --- | --- | --- |
| event_type | [RequestEventType(enum)](#requesteventtype) | 主类型。 |
| sub_type | [RequestEventSubType(enum)](#requesteventsubtype) \| None | 子类型。 |
| comment | str \| None | 请求附言。 |
| flag | str | 请求 flag，用于向协议服务指定该请求。 |
| user_id | str | 请求者 QQ 号。 |
| group_id | str \| None | 群号。 |
| user_aha_id() | async int \| None | 用户 [AHA ID](../模块开发/跨平台统一%20ID.md)。事件的 `user_id` 属性为 `None` 时返回 `None`。 |
| group_aha_id() | async int \| None | 群 [AHA ID](../模块开发/跨平台统一%20ID.md)。事件的 `group_id` 属性为 `None` 时返回 `None`。 |
| user | [User](./平台个体.md#user) | 可用于[事件匹配表达式](../模块开发/事件匹配表达式.md)的 `PM.user` 字段。 |
| group | [Group](./平台个体.md#group) | 可用于[事件匹配表达式](../模块开发/事件匹配表达式.md)的 `PM.group` 字段。 |

<details>
<summary>便捷方法</summary>

### process()

| 参数 | 类型 | 仅关键字参数 | 说明 |
| --- | --- | --- | --- |
| approve | bool | ❌️ | 是否同意请求。 |
| remark | str \| None | ✅️ | 添加好友时设置备注。 |
| reason | str \| None | ✅️ | 拒绝入群时的拒绝理由。 |

</details>

### RequestEventType

| 枚举 | 简述 |
| :---: | :---: |
| FRIEND | 加好友请求 |
| GROUP | 加群请求/邀请 |

### RequestEventSubType

| 枚举 | 所属主类型 | 简述 |
| :---: | :---: | :---: |
| ADD | GROUP | 加群请求 |
| INVITE | GROUP | 入群邀请 |

## Notice

承载群或群成员状态变更、消息状态变更、Poke等通知。

| 属性 | 类型 | 适用事件类型 | 说明 |
| --- | --- | --- | --- |
| event_type | [NoticeEventType(enum)](#noticeeventtype) | | 主类型。 |
| sub_type | [NoticeEventSubType(enum)](#noticeeventsubtype) \| None | | 子类型。 |
| operator_id | str | group_decrease、group_increase、group_ban、group_recall | 操作者平台 ID。 |
| duration | int | group_ban | 禁言时长。 |
| message_id | str | group_recall、friend_recall | 被撤回的消息 ID。 |
| target_id | str | notify.poke | 目标 ID。 |
| user_id | str | ALL | 操作相关用户平台 ID。 |
| group_id | str | group_admin、group_card、group_decrease、group_increase、group_upload、group_recall、group_ban、essence、reaction、notify.title、notify.group_name、notify.poke | 操作相关群平台 ID。 |
| user_aha_id() | async int \| None | | 操作相关用户 [AHA ID](../模块开发/跨平台统一%20ID.md)。事件的 `user_id` 属性为 `None` 时返回 `None`。 |
| group_aha_id() | async int \| None | | 操作相关群 [AHA ID](../模块开发/跨平台统一%20ID.md)。事件的 `group_id` 属性为 `None` 时返回 `None`。 |
| user | [User](./平台个体.md#user) | | 可用于[事件匹配表达式](../模块开发/事件匹配表达式.md)的 `PM.user` 字段。 |
| group | [Group](./平台个体.md#group) | | 可用于[事件匹配表达式](../模块开发/事件匹配表达式.md)的 `PM.group` 字段。 |

### NoticeEventType

| 枚举 | 简述 |
| :---: | :---: |
| GROUP_ADMIN | 群管理员变更 |
| GROUP_DECREASE | 群成员减少 |
| GROUP_INCREASE | 群成员增加 |
| GROUP_BAN | 群成员禁言 |
| GROUP_CARD | 群成员名片变更 |
| ESSENCE | 群置顶/精华消息变更 |
| FRINED_ADD | 好友添加 |
| GROUP_RECALL | 群消息撤回 |
| FRIEND_RECALL | 好友消息撤回 |
| REACTION | 群消息表情回应 |
| NOTIFY | 通知 |

### NoticeEventSubType

| 枚举 | 所属主类型 | 简述 |
| :---: | :---: | :---: |
| SET | GROUP_ADMIN | 设置管理员 |
| UNSET | GROUP_ADMIN | 取消管理员 |
| LEAVE | GROUP_DECREASE | 成员离开 |
| KICK | GROUP_DECREASE | 成员被踢 |
| KICK_ME | GROUP_DECREASE | 自己被踢 |
| DISBAND | GROUP_DECREASE | 群被解散 |
| APPROVE | GROUP_INCREASE | 成员通过申请 |
| INVITE | GROUP_INCREASE | 成员被邀请 |
| BAN | GROUP_BAN | 禁言 |
| LIFT_BAN | GROUP_BAN | 解除禁言 |
| POKE | NOTIFY |
| GROUP_NAME | NOTIFY | 群名变更 |
| TITLE | NOTIFY | 群头衔变更 |
| ADD | ESSENCE | 添加群置顶/精华消息 |
| DELETE | ESSENCE | 删除群置顶/精华消息 |

## MetaEvent

协议适配器与协议服务的元事件。

| 属性 | 类型 | 适用事件类型 | 说明 |
| --- | --- | --- | --- |
| event_type | [MetaEventType(enum)](#metaeventtype) | | 主类型。 |
| sub_type | [LifecycleSubType(enum)](#lifecyclesubtype) | LIFECYCLE | 协议适配器生命周期子类型。 |
| interval | int | HEARTBEAT | 心跳间隔。 |
| status | [HeartbeatStatus](#heartbeatstatus) | HEARTBEAT | 心跳状态。 |

### MetaEventType

| 枚举 | 简述 |
| :---: | :---: |
| HEARTBEAT | 心跳 |
| LIFECYCLE | 协议适配器生命周期 |

### LifecycleSubType

| 枚举 | 简述 |
| :---: | :---: |
| CONNECT | 与协议服务成功建立持久连接 |
| DISCONNECT | 与协议服务断开持久连接 |

### HeartbeatStatus

| 属性 | 类型 | 说明 |
| --- | --- | --- |
| online | bool | 协议服务是否在线。 |
| stat | HeartbeatStatusStatistics |

## MessageSent

协议服务登录账号发送消息事件，继承自 [Message](./消息.md#message)。

| 属性 | 类型 | 说明 |
| --- | --- | --- |
| target_id | str \| None | 私聊目标用户平台 ID。 |

## models.core.EventCategory

枚举类型。

| 枚举 | 描述 |
| --- | --- |
| SERVICE_REQUEST | 适配器请求 Aha 服务。 |
| RESPONSE | 多进程模式下适配器响应 API 调用。 |
| EXTERNAL | 外部事件。 |
| CHAT | 消息事件。 |
| NOTICE | 通知事件。 |
| REQUEST | 请求事件。 |
| META | 元事件。 |
| SENT | 消息发送事件。 |
