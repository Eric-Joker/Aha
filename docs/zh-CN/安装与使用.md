## 环境需求

- CPython >= 3.14

## 安装

首先，下载由源代码打包的压缩包并解压或使用 Git 克隆仓库：
```sh
git clone https://github.com/Eric-Joker/Aha.git
cd Aha
```
然后，安装依赖（择一）：
```sh
pip install -r requirements-full.txt -U # 全部依赖项，包括 性能优化所需库、asyncpg、psycopg[binary]、Playwright、FastAPI 等。
```
```sh
pip install -r requirements.txt -U # 基础依赖项，需额外安装 SQLite 或 postgreSQL 的异步和同步引擎，且不包括性能优化。
```
若存在依赖冲突，请使用 venv 或其他环境隔离方案，或卸载其他依赖着古老依赖的库。

若需要浏览器相关特性，请安装 Playwright：
```sh
# Linux 需要安装依赖。下行仅适用于 Debian / Ubuntu
apt update && apt install -y libgtk-4-1 libgraphene-1.0-0 libxslt1.1 woff2 libevent-2.1-7 libgstreamer-plugins-base1.0-0 libwebpdemux2 libharfbuzz-icu0 libenchant-2-2 libhyphen0 libmanette-0.2-0 gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly
```
```sh
playwright install # 若找不到命令，需要重启当前终端窗口
```

## 配置与运行

```sh
python3.14 aha.py
```

每次启动时，会先检查是否存在新增配置项，若存在会写入配置文件并终止运行，修改配置后可再次启动。

基于环境变量 `BOT_ENV` 区分配置文件，采用的文件为项目目录下的 `config.BOT_ENV.yml`，默认为 `dev`。

配置文件中的`bots`键配置协议适配器，值为列表，每个字典元素都会启动一个适配器服务。适配器的配置详情见[已有适配器](./已有适配器/README.md)。

配置文件的注释也由 Aha 严格管理，非自动生成的注释会被移除。

在 Linux 生产环境时，后续可以通过项目提供的 `./run.sh` 启动项目。

### CLI 选项

| 选项 | 说明 | 示例 |
| --- | --- | --- |
| `--load-only`/`-l` | 仅加载指定模块。 | `--load-only module1 module2` |
| `--exclude` | 不加载指定模块。 | `--exclude module1 module2` |
| `--no-db-backup` | 存在该选项时，若出现数据库结构更改，跳过备份数据库。 |

## 模块（插件）

在项目根目录下的 `modules` 文件夹中的所有 Python 模块均可视为 Aha 的模块。

### CLI 模块管理

| 选项 | 说明 | 示例 |
| --- | --- | --- |
| `--enable`/`-e` | 启用指定模块。 | `--enable module1 module2` |
| `--disable`/`-d` | 禁用指定模块。 | `--disable module1 module2` |

其余功能暂不存在。

### 安装

将`.py`文件或包含`__init__.py`的文件夹放入 `modules` 文件夹下即可。

### 禁用

将模块文件或文件夹重命名为 `DISABLED` 开头即可。

### 面向平台用户/群组的黑白名单

[配置文件](./模块开发/统一配置系统.md)的 `aha` 键下有 `default_group_list`、`default_user_list` 键值，表示全局默认的平台用户/群组黑白名单。

Aha 支持在配置文件中为每个模块建立单独的黑白名单：

```yaml
modules.xyz:
  user_list_mode: blacklist  # 模块级黑名单会与默认的黑名单取并集
  user_list:
  - platform: QQ
    user_id: '114514'
  group_list_mode: whitelist  # 模块级白名单会完全忽略默认白名单
  group_list:
  - platform: QQ
    group_id: '1919810'
```
