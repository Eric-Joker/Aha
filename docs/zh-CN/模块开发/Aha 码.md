# Aha 码

这是一个类似 [CQ 码](https://docs.go-cqhttp.org/cqcode)的概念，用于将任意[消息段](../数据结构/消息序列与消息段.md)嵌入到字符串中。这是它的基本语法:
```
[Aha:小写消息段类型,属性=值,属性=值]
```
将多个 Aha 码与普通字符串拼接在一起就能得到一个字符串形式的消息序列。其中 [Text](../数据结构/消息序列与消息段.md#text) 消息段不使用 Aha 码形式，例如：
```
[Aha:at,user_id=114514]早上好啊
```

属性值为 `None` 时需省略属性值对。

> Aha 码中不应有多余的空格。

## 转义

可以通过 [`utils.aha.escape_aha` 和 `utils.aha.unescape_aha`](./内置轮子与最佳实践/零碎%20utils.md#escape_aha--unescape_aha) 函数进行转义和反转义 Aha 码。

### 具体规则

Aha 码由字符 `[` 起始, 以 `]` 结束，并且以 `,` 分割各个参数。如果 Aha 码中的属性值包括了这些字符, 那么它们应该被通过 HTML 实体转义。

| 字符  | 对应实体转义序列 |
| --- | -------- |
| `&` | `&amp;`  |
| `[` | `&#91;`  |
| `]` | `&#93;`  |
| `,` | `&#44;`  |

> 只需要转义这四个字符，其他字符对 Aha 码来说不算特殊字符所以不需要转义。
